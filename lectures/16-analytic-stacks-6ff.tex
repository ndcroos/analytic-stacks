% !TeX root = ../AnalyticStacks.tex

\section{\ufs Analytic stacks and 6 functors (Scholze)}

\url{https://www.youtube.com/watch?v=BV0-dlAuS3U&list=PLx5f8IelFRgGmu6gmL-Kf_Rl_6Mm7juZO}
\renewcommand{\yt}[2]{\href{https://www.youtube.com/watch?v=BV0-dlAuS3U&list=PLx5f8IelFRgGmu6gmL-Kf_Rl_6Mm7juZO&t=#1}{#2}}
\vspace{1em}

\begin{unfinished}{0:00}
So, last time we were starting the discussion of -- and we really didn't get into the actual definition that we used, but we were trying to give an overview of what the definition should look like and what kind of examples it should accommodate. And so today, I want to go more into -- like, I want to talk about analytic spaces. But something that I think is important is how we set up this definition. It's actually a series of six functions.

Okay, so last time, we saw some motivation for making a definition of -- I want to be in some category, just -- this definition, modulo some set-theoretic issues that I'll explain in a moment. And then, in that series of -- some other things related to sheaves, Hyper-sheaves, and so on. I will probably also say something at the end of this lecture.

So, we would like to define our geometric object by which gives us our basic building blocks, the spaces, and then specify some topology that tells us how we're allowed to glue them together. The key question is, which Grothendieck topology is appropriate to put on this? There was some motivation for this definition, and lots of examples were mentioned that we will be taking up again once we have the proper definition of the category.

Before I get there, let me remark that what we're doing here is kind of very, very close to something we did at the beginning of the course. We defined condensed sets, or "lightly condensed sets," on the category of profinite sets. And there, we were playing a similar game, where we had some basic objects that we started with, and we're building a larger category by allowing ourselves to glue them in a certain way. The gluing that we allow was specified by the Grothendieck topology that we chose. And there, we chose a rather general Grothendieck topology, allowing all, in particular, all surjective maps of profinite sets.

And now, we're repeating this game with a much broader class of basic geometric objects, corresponding to these analytic rings. These are able to model all sorts of different geometries -- they can model aspects of just algebraic geometry, they can model some $p$-adic geometry, some complex geometry, whatever. And all these different kinds of geometry are somehow built, you can put them together in this world of analytic stacks and build spaces out of all of these things together.

So, the key question is, which Grothendieck topology are we going to put on this? Here are some things that we want. The most important variant -- if you have a triangle of analytic animated rings, then the primary invariant that we're interested in is its derived category of complete modules. Recall that this was defined as the full subcategory of the derived category of the condensed animated modules, such that all the homology groups are...
Complete. Okay, so this is the primary variant, and we want that some a met the v a is a sheet. But this is, it's a drive. The only sensible way to phrase this is that it's an $\infty$-category. So we actually need to treat this as an $\infty$-category from now on.

Let's start with something we want. We want this, so this already means that for any analytic stack $x$, we will be able to define the $\infty$-category of $\mathrm{PD}$-crystals on $x$. This is just the limit over all $a$ that belongs to something. That's good, but actually we want something flatly more. This is some business with the six functors.

So we also want $x$ to have a structure of the six functors. Let me say a little bit about what this is. There are six functors: there is always a !-functor, which has some kind of right adjoint, which is an internal Hom; then there is a pullback functor, which has a right adjoint, which is the pushforward; and then there will be two more that we would like to have, you would have to like a $!$-functor and the right adjoint.

So this structure should exist: each $\mathrm{D}(x)$ should have a symmetric model structure, and then whenever you have a model, you can ask for an internal Hom object, which has the usual relation to the model. If such an internal Hom exists, it's called a closed symmetric structure.

Then whenever you have a morphism $f$ from $y$ to $x$, there should be a pullback functor, and this should actually be compatible with the tensor product, should be a tensor functor. And this should have a right adjoint, which is the pushforward. This is something we just get automatically because, like when you have a morphism of rings, you can base change modules, and also then the same functor on $\mathrm{D}(x)$ and $\mathrm{D}(y)$ will be compatible with base change.

But then there are these lower shriek functors, not shriek functors, and so this is a more delicate kind of structure which only exists for certain $f$ from $y$ to $x$. We want the functor that lifts this cohomology, this compactly supported cohomology, and this should satisfy two properties:

One is the base change property, so whenever you have a morphism $Y$ and you have any base change of this, first of all the base change should be again in the $!$-setting where this works, but secondly, there should be a natural isomorphism between taking first the $!$-functor and then pulling back, versus first pulling back and then taking the $!$-functor.

And another thing that it should satisfy is a projection formula isomorphism, that for $a$ in $\mathrm{D}(x)$ and $b$ in $\mathrm{D}(y)$, you're trying to say how these lower shriek functors interact with the existing structure, and so the first thing is that with a pullback they should just commute in this sense, and then with a tensor product, you have the following property that when you have $a$ and $b$, then taking the $!$-functor of the tensor product is the same thing as the tensor product of the $!$-functors.

This is the kind of structure that arises in a lot of different contexts in mathematics. The most classical, in some sense, is if you take some nice topological space, something locally compact, then this has a structure for morphisms where this is literally the compactly supported cohomology. And then you can derive that $f$ what with setting.

Actually, the first time this was developed, not for this case, but it was for $\mathit{D}$-modules on schemes, I think, but then it was realized that there's, I don't know, you can also do this for $\mathit{D}$-modules, and you can also, there are lots of different settings where you can do this. One setting where it was however not so much developed is the setting of varieties, now some kind of coherent settings or quasi-coherent settings, where usually you don't really have a notion of compactly supported cohomology. There is this appendix of Deligne's "Residues and duality" where he kind of

Don't say "um", but actually, our goal will naturally go through a series of $c_{c}$ that behaves rather well, and we absolutely want to have it.

Before going on, let me make a remark, because I think Gouvea will complain in a second that there's a completely imprecise definition here of what the six-functor formalism is. When I write this isomorphism here, there is no natural comparison between the two---these are just two random functors. But they should naturally be identified. So you have to supply this isomorphism. But once you start supplying this isomorphism, then you run into trouble, because now I don't know---you can like base change twice, and then there are comparison maps here, comparison maps here, and one for the composite. Of course, you would hope that they commute, but then you start to wonder how many different such things you can write down and which kind of compatibilities you have to enforce.

I think for a while, it was some kind of open question what a really good and minimal way to encode all the data that is present in a six-functor formalism. There has been work by Liu-Zheng where they do this in the world of $\infty$-categories, and there's been work of Gaitsgory and Rozenblyum where they actually've Centede, although their approaches have different names and so they don't really talk about complexes with compact support at all. In the classical setting, they've set up some kind of notion of what such a six-functor formalism is. That treatment is however $\infty$-categorical, and so that's difficult. Then, maybe, Lucas Mann really isolated a key structure that you need.

So, yeah, there is a goal. I gave a course about this last winter, so let me simply refer you there. But something I was also personally taking away from this course is that if you're just interested in the six-functor formalism, then this kind of dictates everything, including the growth topology.

Okay, right. So, before starting the discussion in our specific case, let's recall the usual definition of such an $\infty$-functor. You do this by specifying two collections of morphisms: there's a class of proper morphisms, and here an $\infty$-functor will actually just be a functor. But if you want to make this definition, you better check that it satisfies the properties that an $\infty$-functor should satisfy---you need proper base change and the projection formula to hold. This time, the situation is better, because when you take this to be a functor, there's actually always a natural base change transformation. So here, I'm not supplying data, I'm just asking for conditions. When you want to declare a morphism to be proper and an $\infty$-functor to be an $\infty$-functor, there's something you can simply check---whether the natural base change transformation is an isomorphism in the case of this morphism $f$, and similarly for the projection formula.

There's also a class of open immersions, where instead you ask that the right adjoint of $f$ for open immersions is the left adjoint of base change. Again, you need to check that this is a reasonable definition, so you need to check that it satisfies base change and projection formula. But this time, again, if it's a left adjoint, there is a natural comparison map between these two things going in the other direction, and you ask that these things are satisfied.

The general morphisms $f$ that are $\infty$-stackable are the ones for which this $\infty$-functor is defined. They're taken to be the composites of an open immersion and a proper morphism. We have open and proper that go far, and the maps that you can choose are the ones which you can somehow compactify, and then you want to declare that the $\infty$-stack is compactly generated.

The definition of properness comes up with a really big caveat: when you write down this as a definition, it's not really a definition, because it chooses the compactification. In general, there are many possible ways to compactify. So you have to show that this definition is independent of the choices, canonically, because you really want to get a final structure. You don't just need to show that it's unique up to isomorphism, but even the isomorphism is unique up to higher isomorphism, and so on.

Fortunately, there is a theorem that was essentially proved by X, and then slightly streamlined in this formulation by Y. Under really minimalistic assumptions on the classes of proper maps, open embeddings, and some general finite maps (so essentially just what I said, except, for example, you want that a composite of finite maps can still be compactified), the theorem is that Z can always produce such a compactification. The precise theorem is in these lecture notes or in Y's work.

In particular, these assumptions include no condition whatsoever on uniqueness of compactifications. You don't assume something like the two compactifications can be dominated by a third one. The question in the chat is whether we can use this formalism for characteristic classes, index theorems, and so on. Yes, that's the kind of things we hope to do with this.

Now, let's apply these general ideas to our setting. We start with the category or $\infty$-category C, which is the category of analytic rings, or "affinoid analytic spaces" if you want. We will generally call an object in here the analytic spectrum of some A, but the underline does not mean it's a topological space---it's just a symbol to say we're taking a geometric object and passing through the opposite here.

We need to figure out which morphisms here should be proper, which should be open embeddings, and at this point we should forget any preconceived notion of what a proper morphism in algebraic geometry is, and really just look at what the formalism tells us. It turns out that a morphism of analytic rings from B to A is proper. This notion of properness is different from the usual one you use in algebraic geometry.

Context: He was talking about a pair of animated condensing light condensing and the subcategory of the connective derived category satisfying some conditions. 

Right, so whenever you have any analytic geometry and just an animated algebra over the underlying animated condensed algebra, then you can always endow this one with an analytic ring structure where completeness is just completeness where you restrict the relation to the condensed one. Whenever we have any map of analytic rings, there's an induced one, and then there is some kind of localization where you're just taking the same ring but then doing a formal completion. This geometrically corresponds to the process of compactifications, although this may or may not be an open embedding.

Here's a proposition: if a proper map of analytic Huber pairs satisfies the projection formula, then it is an isomorphism. The only reason this seems at all sensible is because it matches the notion of properness that applies to formal schemes. In the case of formal schemes, there's always this completion sequence, and if you have a map of formal schemes where the completion upstairs is the smallest possible thing determined by the completion downstairs, this is already proper and satisfies all the good properties that a proper map should satisfy.

The projection formula says that for a proper map of analytic Huber pairs $f: A \to B$, and any $M$ over $A$ and $N$ over $B$, we have $f_*M \otimes_B N \cong f_*(M \otimes_A f^*N)$. This should be intuitively true, since base-changing $M$ from $A$ to $B$ and then tensoring with $N$ should be the same as tensoring $M$ with the base-change of $N$. The key is to be careful about the precise meaning of the symbols and check the details.


Actually, the thing must be the same. All right, and so, in general, you just have to do the same argument more carefully. Namely, I mean, in general, you can just take $n = B$; then the left-hand side becomes the base change from $M$ to $B$ in the sense of analytic rings, but the right-hand side is a base change from $M$ from $A$ to $B$ purely in the sense of complete $A$-module. And so, that these agree is precisely the assertion that it's in very---

So, you get this equation where the $T$ has these meanings, and that they agree that the base change in the sense of analytic is just the tensor of $A$ is precisely saying that this must be induc because for the IND ener structure is precisely how you comp to base change in general when you compute the base change for rings. And first, you do the base change for juices, so you do this, but then afterward, you would still have to make it complete as a $B$-module. But here, it's saying that you don't actually have to do it.

Okay, was a question? I'm not sure what the question is, like the map from the fine line to a point is not proper in usual algebraic geometry, but if you pass through this word, it's counted as a proper here because it satisfies the projection formula and also satisfies proper base change and so on. I mean, actually, in classical base change for complex geometry, you don't need to ask for proper; you only need to ask for quasi-compact and quasi-separated.

So, Dustin would be able to give a really good solution to this. This is good. So, it's just a class of proper maps, it's on the base stack, and proper base change and the projection formula for proper base change, same base change, or it tells you that after any base change, the projection formula still holds. But also, proper base change---he would be able to check if you haven't induced any the structure, then you can just unravel what all the symbols mean, and it comes out right.

All right, so let's get to the class of open immersions, and again, I ask you to forget any preconceived notion of what an open immersion is. I'll give examples in a second. Let me actually call it $\mathcal{J}$, just for psychological comfort. Merge, if the $P$ map $B$ of modules $\mathcal{A}$-dit, the left three, set the projection from---

So, let me give a first example and then a non-example. A non-example is any open immersion in algebraic geometry that's not also a closed immersion, open-closed immersions. Okay, there, I don't know, they're kind of stupid, but like, if you take $\mathbb{G}_m \times \mathbb{Z}$ inside of some $\mathbb{Z}[t]$ with like, trivial ring structure, this is not an open immersion because usually, in algebraic geometry, taking the tensor of modules virtually never commutes with any infinite products, right? If you want left joint, it should mean that the pullback should commute with products.

But here's a key example: if you take the Spec of $\mathbb{Z}[p^{-1}]$ solid, this will be an example, or also sometimes more primitive because this one can be realized as the base change of this one, not quite, but essentially. The key thing to know is that if you take these joint solid and advance this into the induced one solid, this is open. This is something that already came up in

In terms of this, from this funny object, this thing should receive a map from $M$. Indeed, this complex it gives us a homological degree in $\mathbb{Z}$. This complex, which on cohomology gives us this junction, I think if you look back at Dustin's lecture on the certification of a $\mathbb{Z}$-joint, this is the formula he gave. This means that actually, if you tensor with this object, then this would become the left joint. 

It is $\mathfrak{m}$-injective in this one $\mathfrak{S}$, and here this means the comp. And so this means that this left joint exists on the image of $\text{Jappa}$, but $\text{Jasta}$ is essentially surjective. This also says that this left joint is given by tensoring some module, which is exactly what you need to check that projection.

Why is this reasonable? Why does this have anything to do with the intuitive idea that these lower $\mathfrak{S}$-functors should be some kind of compact support? In particular, like of the structure sheaf of $\mathbb{X}$, the upper stalk of $\mathfrak{S}$ should be like the compactly supported coherent cohomology in some sense of the affine line. 

Well, what should it take to give a compactly supported thing? You should vanish near infinity. Giving a function, that's an element of $\mathbb{Z}[[T]]$, and now you want to say that vanish at infinity. But infinity is going to get functions the $\frac{1}{T}$ series, and so you would like to take functions that vanish near infinity. 

The key thing making this work here is that you get some localization with these properties. The key thing you need to check when you want to check that, for example, this is what the completion does, is that $\mathbb{Z}[T^{-1}]$ is an important algebra. It's an object if you tensor it with itself, it's still itself. This is in fact the general description of these open immersions.

Given some $X$, the open immersion $J$ from some $Y$ into $X$ are equivalent, or anti-equivalent, I'm not sure right now, to idempotent commutative algebra $C$ such that the internal Hom from $C$ preserves some contivity assumption. Here, $J$ maps to the following. You can check $J^\dagger$ of the unit, and this will always map back to the unit, and the cone of that map is always an idempotent algebra.

The projection formula implies that the étale module is really just the stalk of the unit and the rest. This means that this thing is completely determined by the right module. So this means that the right module is actually just given by the internal Hom from the unit. Because the left adjoint tensoring with some object is our Hom from the unit, we know that the completion is really just given like this. This means that, in particular, this new analytic geometry structure is completely determined by this object, and then you just have to specify, or equivalently by this co-map, because then we can recover it by taking the fiber from one to C.

Then you just need to supply the conditions on this so that this completion really determines the analytic $R$-structure. For this, you need to check two things: that this completion commutes with all co-limits, and that it should preserve connectivity. All the other properties of the analytic $R$-structure are just some formal procedure to check.

Basically, when you have an open immersion, there is always this item but commutative algebra describing a space at infinity. In the sense of this open immersion, you have this open immersion, and then there's some kind of complementary closed subset determined by some algebra which is functions at infinity. This is an important algebra. The general idea is that whenever you have an open immersion, there is a complementary thing at infinity which is described by some algebra.

As a corollary of this, you can check that the class of étale maps is stable under base change. So we've isolated what the proper open immersions are. This leads us to a stable map. If you factor open and proper, we already know which proper map to take because I already told you about this canonical characterization of any Mori structure and then some kind of localization. This $F$ it always specifies some canonical $\overline{F}$, in this case the compactification is canonical, which is nice.

This $J$ always exists, and it will also always have the property that $J$ does for the factful. The real only condition is that you have the left adjoint, the projection formula. An interesting example here is if you take the solid structure on $\mathbb{Z}$, which is a complexification, but precisely this one over $s_0$. More generally, if you have any $M$-finite type algebras and take the solid relative ring structure, then these maps will all be étale, or if you have a map of pairs, then being étale is exactly this condition that Huber calls being of $+$-weakly finite type, which just means that the subring of integral elements $A^+$ is generated by just finitely many new elements.

Huber was defining these kinds of finite notions also for $\mathbf{p}$-adic spaces, but now they are also the ones where you can define relative étale functoriality for proper open immersions as well. Yes, that's next. There is a little bit to check, like if you take a composite of two étale maps, that's true, basically just by composition on the base change. And then for the $\mathbf{s}$-functor, there's one thing you have to check, which is some interaction between the lower and the lower star functor for open immersions and proper maps. Again, that's a very straightforward check.

I didn't discuss in this lecture all the little X's you have to put to make this work. There are some little bits to check, but each of them is a really simple check. As a proposition, basically a corollary to this general construction of success, some the fall re, you can say that this data, like of proper maps, open maps, satisfies all the required conditions to get enough étale cohomology on our category $C$, which I recall.

Now, a general question I had: Given a functor $f: X \to \mathcal{C}$ from some category $\mathcal{C}$, one may want to pass to a larger category of geometric objects built by gluing objects in $\mathcal{C}$, just like schemes are built from affine schemes. This was maybe the original question that Lurie and Joyal were interested in when they wanted to extend from schemes to $\infty$-stacks or higher $\infty$-stacks.

I proved some general results about how one can go about extending a functor from one category to another. This was also used by Lukas Main, who started rephrasing it, and when I got to Scholze, I again slightly rephrased what they did. In my notes on six functors, I tried to analyze this question and pin down the best topology for such extensions.

I didn't completely settle on a very precise combination of this topology, as it's slightly ugly at one point. But the takeaway is that the covers should basically be those that satisfy "universal star descent" and "universal codescent." I'll explain what I mean by this in a moment.

Let me just state a theorem that in the case we're in, you should ask for universal star and universal codescent, which seems like a lot to check. But actually, you need to check much less---to some extent, it's always any six functor, but I think it seems better here.


Even stronger, it satisfies to the end. So, if you're not thinking about---usually we have a ring and you think about the category of modules, but now we can go one categoric level higher and think about presentable stable $\infty$-categories linear over $\mathcal{D}(A)$, and it turns out that asking for Schröder descent is equivalent to asking for descent at a 2-categorical level, which is actually how the proof is obtained, but this is probably not one I want to do now in the last five minutes.

Let me just end by giving the definition of the $\mathrm{gr}$ topology. That was the first step to fall on. Well, generally, on the one hand, just by finite just unions. So, whenever you have a $\mathrm{gr}$ topology, it's just a union of several, then it's covered by those. This includes the empty cover of the empty set.

And these satisfy some compatibilities, $\mathcal{F}$, so this is a rather general class of things. It's actually very, very close to related to this notion of descendability that we defined, which is some nice notion of descent that's satisfied for virtually all faithfully flat maps, at least all those that are countably presented, which will be another motivation actually for us to at one point switch to the $\mathrm{\ell}_{\mathrm{tx}}$ setting, because there, things are countably generated.

Particularly, if we restrict to proper maps, then this condition of Schröder descent is precisely the condition that the map of algebras descends. Yeah, have that, and then, okay, they, like in the beginning of my lecture, I said that there are two small wrinkles---one about set-theoretic issues, so again, we should look at accessible things, and for this, we should check that this $\mathrm{gr}$ topology has some approximation properties, which means that specification of something accessible stays acceptable.

The other, some hypercompleteness issues, is that we actually don't want the thing that's just sheaves on this, because also in the $\mathrm{\ell}_{\mathrm{tx}}$ setting, we're actually considering hypersheaves. So, we actually want to allow a certain class of hypersheaves, but it's the same ideas that go into the classical notion of hypersheaves.

Okay, basically, $\mathrm{\ell}_{\mathrm{tx}}$ will be hypersheaves on $\mathcal{F}$, $\mathrm{\ell}_{\mathrm{tx}}^{\ \mathrm{fin}}$. All right, let me take a question. What do you mean by finite unions? Well, I mean you can have like $\mathcal{F}$-$\mathrm{\ell}_{\mathrm{tx}}$ objects, they have finite unions. I mean, like rings and finite products, and so whenever I take such an $\mathcal{F}$-finite union of $\mathcal{F}$-$\mathrm{\ell}_{\mathrm{tx}}$ objects, it should stay in $\mathrm{\ell}_{\mathrm{tx}}^{\ \mathrm{fin}}$, which is like it's covered by the individual ones.

Right, no, just this is a cover whenever $I$ is a finite set and $x_i$ are in $\mathcal{F}$, then this is also an 

It's an extremely wonderful structure that Jacob Lurie defined, this category of presentable Infinity categories with colimit-preserving functions. In there, you have a subcategory of stable ones, or also, whenever you work over some ring, you have some categories which are linear over some base, e.g. the derived category of a ring. These are, loosely speaking, DG categories, where the functions are colimit-preserving. This has a well, maybe a tangent structure. 

Now you can also ask whether the association that takes such an algebra or the spectrum of it to this Infinity one or Infinity two category, it doesn't matter which one you choose for this purpose of asking for descent, whether this satisfies descent. By modular categories, I mean objects in this same Jacob Lurie's formalism. 

For example, the derived category of something over a ring A is in this category, as is the derived category of an A-algebra. If you glue such things locally, then you are given the descent data. And why is it Infinity? The hom between two such things is viewed as an Infinity one category, actually, because you can't forget about the non-invertible 2-morphisms, and then you get an Infinity one category. 

For the question of descent, it turns out that the 2-categorical structure of this thing doesn't matter much, and the non-invertible 2-morphisms will automatically satisfy the descent condition. For these questions, I would really recommend reading the paper of Artem Yurievich Belorussov.
\end{unfinished}